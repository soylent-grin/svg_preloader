<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>SVG Preloader</title>
        <meta name="viewport" content="width=device-width">
        <style>
            body{
                text-align: center;
                font-family: Verdana, sans-serif;
            }
            .container{
                display: inline-block;
                margin-bottom: 10px;
            }
            svg{
              cursor: pointer;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <p>SVG Preloader Demonstration</p>
            <svg
               xmlns:svg="http://www.w3.org/2000/svg"
               xmlns="http://www.w3.org/2000/svg"
               version="1.0"
               width="532"
               height="517"
               id="svg2">
              <defs
                 id="defs4" />
              <g
                 transform="translate(971.71429,197.56639)"
                 id="layer1">
                <path
                   d="M 161,239 C 161,239 78.5,510 78.5,510 C 78.5,510 283.5,451 283.5,451 C 283.5,451 161,239 161,239 z"
                   transform="translate(-971.71429,-197.56639)"
                   id="path2455"
                   style="fill:#97ccc8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <path
                   d="M -810.71429,41.43361 C -810.71429,41.43361 -963.71429,190.93361 -963.71429,190.93361 C -963.71429,190.93361 -893.21429,312.43361 -893.21429,312.43361 C -893.21429,312.43361 -810.71429,41.43361 -810.71429,41.43361 z"
                   id="path2457"
                   style="fill:#77bcac;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <path
                   d="M 8.5,388.5 C 8.5,388.5 283.5,451 283.5,451"
                   transform="translate(-971.71429,-197.56639)"
                   id="path3229"
                   style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1046.0293,-274.85949)"
                   id="path3231"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1320.0293,-336.8595)"
                   id="path3233"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1250.0293,-215.8595)"
                   id="path3235"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M -728.21429,-67.06639 C -728.21429,-67.06639 -811.21429,42.93361 -811.21429,42.93361 C -811.21429,42.93361 -599.71429,41.43361 -599.71429,41.43361 C -599.71429,41.43361 -728.21429,-67.06639 -728.21429,-67.06639 z"
                   id="path3237"
                   style="fill:#97ccc8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1167.5293,-487.8595)"
                   id="path3239"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M -584.21429,-116.06639 C -584.21429,-116.06639 -728.21429,-67.06639 -728.21429,-67.06639 C -728.21429,-67.06639 -599.71429,41.43361 -599.71429,41.43361 C -599.71429,41.43361 -584.21429,-116.06639 -584.21429,-116.06639 z"
                   id="path3241"
                   style="fill:#97ccc8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <path
                   d="M -813.71429,-186.06639 C -813.71429,-186.06639 -963.21429,-36.56639 -963.21429,-36.56639 C -963.21429,-36.56639 -828.71429,-29.06639 -828.71429,-29.06639 C -828.71429,-29.06639 -813.71429,-186.06639 -813.71429,-186.06639 z"
                   id="path3243"
                   style="fill:#97ccc8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1086.0293,-593.8595)"
                   id="path3245"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-941.52934,-642.8595)"
                   id="path3247"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1320.5293,-563.8595)"
                   id="path3249"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1186.0293,-555.8595)"
                   id="path3251"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1171.5293,-716.3595)"
                   id="path3253"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M -813.21429,-188.56639 C -813.21429,-188.56639 -718.21429,-173.56639 -718.21429,-173.56639"
                   id="path3255"
                   style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1073.5293,-700.8595)"
                   id="path3257"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M -472.71429,6.43361 C -472.71429,6.43361 -600.21429,40.43361 -600.21429,40.43361 C -600.21429,40.43361 -547.21429,165.43361 -547.21429,165.43361 C -547.21429,165.43361 -472.71429,6.43361 -472.71429,6.43361 z"
                   id="path3259"
                   style="fill:#97ccc8;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-957.52934,-486.8595)"
                   id="path3261"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-1298.0293,-464.8595)"
                   id="path3263"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M -547.21429,164.93361 C -547.21429,164.93361 -592.21429,251.43361 -592.21429,251.43361 C -592.21429,251.43361 -496.21429,281.43361 -496.21429,281.43361 C -496.21429,281.43361 -547.21429,164.93361 -547.21429,164.93361 z"
                   id="path3265"
                   style="fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-905.02934,-362.8595)"
                   id="path3267"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-950.52934,-275.8595)"
                   id="path3269"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-853.52934,-245.3595)"
                   id="path3271"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M -497.71429,-169.06639 C -497.71429,-169.06639 -448.21429,-93.56639 -448.21429,-93.56639 C -448.21429,-93.56639 -473.71429,6.93361 -473.71429,6.93361"
                   id="path3273"
                   style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-856.02934,-698.3595)"
                   id="path3275"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-805.52935,-620.3595)"
                   id="path3277"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
                <path
                   d="M 290.5,449.75 A 6.75,7.25 0 1 1 277,449.75 A 6.75,7.25 0 1 1 290.5,449.75 z"
                   transform="matrix(1.2592601,0,0,1.1724138,-831.02934,-519.8595)"
                   id="path3279"
                   style="opacity:1;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:16, 16;stroke-dashoffset:0;stroke-opacity:1" />
              </g>
            </svg>                        
        </div>

        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script>
        
        var SVGPreloader = function ( canvas ){ 

            var appear_duration = 1000;

            this.elem = d3.select('svg')
                          .append('g')
                            .attr('id', 'spinner-container')
                            .style('opacity', 0)
                          [0][0];
            this.inProgress = false;        

            this.showPreloader = function(){
              //get all first-level child elements of canvas
              var nodes = d3.selectAll(d3.select(canvas)[0][0].children);
              var elem = this.elem; 
              nodes.transition()
                  .duration(appear_duration)
                  .style("opacity", function(){
                      return (this === elem) ? 1.0 : 0;
                  });
              this.inProgress = true;
            };

            this.hidePreloader = function(){
              //get all first-level child elements of canvas
              var nodes = d3.selectAll(d3.select(canvas)[0][0].children);
              var elem = this.elem;                
              nodes.transition()
                 .duration(appear_duration)
                 .style("opacity", function(){
                      return (this === elem) ? 0 : 1.0;
                 });
              this.inProgress = false;
            };

            function createPreloader(){ 
              d3.xml("spinner.svg", "image/svg+xml", function(xml) {
                document.getElementById('spinner-container').appendChild(xml.documentElement);                     
              }); 
            };  

            createPreloader();        
        };

        var svg = document.getElementsByTagName('svg')[0] ;
        var preloader = new SVGPreloader( svg );
        d3.select(svg).on("click", function(d,i) {

            //set spinner coorditates according to mouse
            d3.select('#spinner-container svg')
              .attr('x', d3.mouse(this)[0] - 40)
              .attr('y', d3.mouse(this)[1])
            preloader.showPreloader();

            //hide after two seconds
            setTimeout( function (){ 
              preloader.hidePreloader(); 
            }, 2000 );
        });

        </script>
    </body>
</html>
